---
title: "Commuting in LA"
subtitle: "An analysis of my time behind the wheel"
output: html_document
---

## Summary

Anyone living in LA will know that spending time behind the wheel is part of life in this part of the world. In this document I visualize some of the data I have collected over the last few months on my commuting times in the drive between Marina Del Rey and my office in Santa Monica.

## Setup

### Load Packages

First we will load in the packages we need including the excellent `googlesheets` as well as our own `redbull` package for chart formatting.

```{r load packages, message = FALSE}
library(googlesheets)
library(tidyverse)
library(magrittr)
library(redbull)
library(lubridate)
```

```{r authorise googlesheets, echo = FALSE, message = FALSE, eval=FALSE}
options(httr_oob_default = TRUE)
gs_auth()
gs_ls()
```

```{r pull google data helper functions}
source("R/get_commuting_data.R")
```

Connect to our Google Sheet and extract the data we need.

```{r extract data, message = FALSE}
commuting_sheet_key <- Sys.getenv("COMMUTING_SHEET_KEY")
comm_data <- get_commuting_data(commuting_sheet_key)
comm_data_clean <- clean_commuting_data(comm_data)
```

Ok so let's look at monthly commute time averages.

```{r plot commute by month, echo = F}
theme_set(theme_rb())

comm_data_clean %>% 
  mutate(Trip_Month = format(Trip_Date, "%Y-%m")) %>%
  ggplot(aes(x = Trip_Month, y = Trip_Duration_Minutes, fill = Direction)) +
  geom_boxplot() +
  scale_fill_redbull("bloomberg") +
  labs(title = "Coming home in September sucks!",
       subtitle = "Average monthly commuting time between Marina Del Rey and Santa Monica",
       x = "Month",
       y = "Commute Time (minutes)")
```

And a more granular view...

```{r plot all commutes, message=FALSE, echo = F}
comm_data_clean %>%
  ggplot(aes(x = Trip_Date, y = Trip_Duration_Minutes, colour = Direction)) +
  geom_point() +
  scale_colour_redbull("bloomberg") +
  labs(title = "Looks like it's getting worse...",
       subtitle = "Commuting time between Marina Del Rey and Santa Monica",
       x = "Month",
       y = "Commute Time (minutes)") +
  geom_smooth(se = F, span = 0.75)
```

```{r, eval=F}
comm_data.tidy %>%
  ggplot(aes(x = Trip_Weekday, y = Trip_Duration_Minutes, fill = Direction)) + 
  geom_boxplot() + 
  facet_grid(~ Direction)

comm_data.tidy %>%
  ggplot(aes(x = Trip_Date, y = Trip_Duration_Minutes, colour = Direction)) +
  geom_point() + 
  geom_smooth(se = F)

comm_data.tidy %>%
  ggplot(aes(x = as.factor(lubridate::month(Trip_Date)), y = Trip_Duration_Minutes, fill = Direction)) + 
  geom_boxplot() + 
  facet_grid(~ Direction)


comm_data.tidy %>% mutate(m = lubridate::month(Trip_Date)) %>% View()


comm_data.mod <- comm_data.tidy %>% 
  select(Trip_Duration_Minutes, Trip_Weekday, Direction, Trip_Date, Trip_Time) %>%
  mutate(Trip_Month = as.factor(lubridate::month(Trip_Date))) %>%
  select(-Trip_Date, -Trip_Time)

commuting_mod <- lm(Trip_Duration_Minutes ~ ., data = comm_data.mod)

```

